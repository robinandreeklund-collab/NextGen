# üöÄ NextGen AI Trader

Ett sj√§lvreflekterande, modul√§rt och RL-drivet handelssystem byggt f√∂r transparens, agentutveckling och realtidsanalys. Systemet simulerar handel med verkliga data, strategier, feedbackloopar och bel√∂ningsbaserad inl√§rning.

---

## üìç Sprintstatus

**Sprint 1 f√§rdig ‚úÖ** ‚Äì K√§rnsystem och demoportf√∂lj komplett
**Sprint 2 f√§rdig ‚úÖ** ‚Äì RL och bel√∂ningsfl√∂de komplett
**Sprint 3 f√§rdig ‚úÖ** ‚Äì Feedbackloopar och introspektion komplett
**Sprint 4 f√§rdig ‚úÖ** ‚Äì Strategiskt minne och agentutveckling komplett
**Sprint 4.2 f√§rdig ‚úÖ** ‚Äì Adaptiv parameterstyrning via RL/PPO komplett
**Sprint 4.3 f√§rdig ‚úÖ** ‚Äì Full adaptiv parameterstyrning i alla moduler

### Sprint 4.3: Full adaptiv parameterstyrning via RL/PPO ‚úÖ

**M√•l:** Ut√∂ka adaptiv parameterstyrning fr√•n Sprint 4.2 till samtliga relevanta moduler.

**Motivation:**
Sprint 4.2 introducerade adaptiva meta-parametrar f√∂r evolution_threshold, min_samples, update_frequency och agent_entropy_threshold. Sprint 4.3 ut√∂kar detta till hela systemet genom att g√∂ra tr√∂skelv√§rden, viktningar och toleranser i strategy_engine, risk_manager, decision_engine, vote_engine och execution_engine adaptiva. Detta m√∂jligg√∂r fullst√§ndig sj√§lvoptimering d√§r varje modul justerar sina parametrar baserat p√• bel√∂ningssignaler, feedbackm√∂nster och agentperformance.

**Moduler i fokus:**
- `strategy_engine` - Adaptiva signal_threshold och indicator_weighting
- `risk_manager` - Adaptiva risk_tolerance och max_drawdown
- `decision_engine` - Adaptiva consensus_threshold och memory_weighting
- `vote_engine` - Adaptiv agent_vote_weight (meritbaserad r√∂stning)
- `execution_engine` - Adaptiva execution_delay och slippage_tolerance
- `rl_controller` - Distribuerar parameter_adjustment till alla moduler
- `meta_agent_evolution_engine` - Anv√§nder adaptiva parametrar fr√•n rl_controller
- `strategic_memory_engine` - Loggar parameterhistorik med beslut
- `agent_manager` - Sp√•rar parameterversioner parallellt med agentversioner
- `introspection_panel` - Visualiserar parameterhistorik och trends

**Adaptiva parametrar (Sprint 4.3):**

1. **strategy_engine:**
   - **signal_threshold** (0.1-0.9, default: 0.5)
     - Tr√∂skelv√§rde f√∂r tradingsignaler
     - Reward signal: trade_success_rate
     - Update frequency: every 20 trades
   
   - **indicator_weighting** (0.0-1.0, default: 0.33)
     - Viktning mellan olika indikatorer (RSI, MACD, Analyst Ratings)
     - Reward signal: cumulative_reward
     - Update frequency: every epoch

2. **risk_manager:**
   - **risk_tolerance** (0.01-0.5, default: 0.1)
     - Systemets risktolerans f√∂r trades
     - Reward signal: drawdown_avoidance
     - Update frequency: every 10 trades
   
   - **max_drawdown** (0.01-0.3, default: 0.15)
     - Maximalt till√•ten drawdown innan riskreduktion
     - Reward signal: portfolio_stability
     - Update frequency: every epoch

3. **decision_engine:**
   - **consensus_threshold** (0.5-1.0, default: 0.75)
     - Tr√∂skelv√§rde f√∂r konsensus i beslutsfattande
     - Reward signal: decision_accuracy
     - Update frequency: every 50 decisions
   
   - **memory_weighting** (0.0-1.0, default: 0.4)
     - Vikt f√∂r historiska insikter i beslut
     - Reward signal: historical_alignment
     - Update frequency: every epoch

4. **vote_engine:**
   - **agent_vote_weight** (0.1-2.0, default: 1.0)
     - R√∂stvikt baserad p√• agentperformance (meritbaserad r√∂stning)
     - Reward signal: agent_hit_rate
     - Update frequency: every epoch

5. **execution_engine:**
   - **execution_delay** (0-10, default: 0)
     - F√∂rdr√∂jning i sekunder f√∂r optimal execution timing
     - Reward signal: slippage_reduction
     - Update frequency: every trade
   
   - **slippage_tolerance** (0.001-0.05, default: 0.01)
     - Tolerans f√∂r slippage vid trade execution
     - Reward signal: execution_efficiency
     - Update frequency: every 10 trades

**Reward signals f√∂r parameterstyrning (Sprint 4.3):**
- **trade_success_rate**: Andel framg√•ngsrika trades
- **cumulative_reward**: Ackumulerad bel√∂ning √∂ver tid
- **drawdown_avoidance**: F√∂rm√•ga att undvika stora kapitalf√∂rluster
- **portfolio_stability**: Stabilitet i portf√∂ljv√§rde √∂ver tid
- **decision_accuracy**: Tr√§ffs√§kerhet i beslut
- **historical_alignment**: √ñverensst√§mmelse med historiska m√∂nster
- **agent_hit_rate**: Tr√§ffs√§kerhet per agent f√∂r meritbaserad viktning
- **slippage_reduction**: Minimering av slippage vid execution
- **execution_efficiency**: Effektivitet i trade execution

**Implementerat (Sprint 4.3):**
- ‚úÖ Adaptiva parametrar i strategy_engine (signal_threshold, indicator_weighting)
- ‚úÖ Adaptiva parametrar i risk_manager (risk_tolerance, max_drawdown)
- ‚úÖ Adaptiva parametrar i decision_engine (consensus_threshold, memory_weighting)
- ‚úÖ Adaptiva parametrar i vote_engine (agent_vote_weight)
- ‚úÖ Adaptiva parametrar i execution_engine (execution_delay, slippage_tolerance)
- ‚úÖ Full YAML-dokumentation i docs/adaptive_parameter_sprint4_3/
- ‚úÖ Uppdaterad docs/adaptive_parameters.yaml med alla 12 parametrar
- ‚úÖ 8 nya tester f√∂r Sprint 4.3 adaptiva parametrar (alla passerar)
- ‚úÖ Parameter adjustment distribution i rl_controller (fr√•n Sprint 4.2)
- ‚úÖ Parameterloggning i strategic_memory_engine (fr√•n Sprint 4.2)
- ‚úÖ Parameterversioner i agent_manager (fr√•n Sprint 4.2)
- ‚úÖ Visualisering i introspection_panel (fr√•n Sprint 4.2)

**Testresultat (Sprint 4.3):**
- ‚úÖ StrategyEngine adaptiva parametrar fungerar
- ‚úÖ RiskManager adaptiva parametrar fungerar
- ‚úÖ DecisionEngine adaptiva parametrar fungerar
- ‚úÖ Signal_threshold anv√§nds i strategibeslut
- ‚úÖ Risk_tolerance anv√§nds i riskbed√∂mning
- ‚úÖ Consensus_threshold anv√§nds i beslutsfattande
- ‚úÖ Parameter adjustment propageras korrekt via message_bus
- ‚úÖ Indicator_weighting p√•verkar indikatorviktning

**Benefits (Sprint 4.3):**
- Fullst√§ndig sj√§lvoptimering av hela systemet
- Dynamisk anpassning till olika marknadsf√∂rh√•llanden och handelsfaser
- Eliminerad manuell parameterfinjustering i alla moduler
- Transparent parameterhistorik och bel√∂ningsfl√∂de f√∂r alla parametrar
- F√∂rb√§ttrad koordination mellan moduler genom adaptiv konsensus
- Meritbaserad agentviktning f√∂r robust beslutsfattande
- Optimal execution timing och slippage-hantering

### Sprint 4.2: Adaptiv parameterstyrning via RL/PPO ‚úÖ

**M√•l:** G√∂r meta-parametrar som evolution_threshold och min_samples adaptiva med PPO-agent.

**Motivation:**
Tidigare var kritiska meta-parametrar som evolutionstr√∂skel, minimum samples, uppdateringsfrekvens och entropitr√∂skel statiska och kr√§vde manuell finjustering. Detta begr√§nsade systemets f√∂rm√•ga att anpassa sig till olika marknadsf√∂rh√•llanden och agentutvecklingsfaser. Genom att g√∂ra dessa parametrar adaptiva via RL optimeras systemets sj√§lvoptimering, robusthet och l√•ngsiktiga agentutveckling automatiskt.

**Moduler i fokus:**
- `rl_controller` - Ut√∂kad med MetaParameterAgent f√∂r parameterstyrning
- `meta_agent_evolution_engine` - Tar emot och anv√§nder adaptiva parametrar
- `strategic_memory_engine` - Loggar parameterhistorik med beslut
- `feedback_analyzer` - Identifierar m√∂nster relaterade till parameterjusteringar
- `agent_manager` - Sp√•rar parameterversioner parallellt med agentversioner
- `introspection_panel` - Visualiserar parameterhistorik och trends

**Adaptiva parametrar:**
1. **evolution_threshold** (0.05-0.5, default: 0.25)
   - Styr n√§r agenter ska evolution√§rt uppdateras
   - Reward signal: agent_performance_gain
   - Update frequency: every 10 decisions

2. **min_samples** (5-50, default: 20)
   - Minimum antal samples f√∂r evolutionsanalys
   - Reward signal: feedback_consistency
   - Update frequency: every epoch

3. **update_frequency** (1-100, default: 10)
   - Hur ofta agenter uppdateras
   - Reward signal: reward_volatility
   - Update frequency: every epoch

4. **agent_entropy_threshold** (0.1-0.9, default: 0.3)
   - Styr agenternas explorations-/exploitationsbalans
   - Reward signal: decision_diversity
   - Update frequency: every 5 decisions

**Reward signals f√∂r parameterstyrning:**
- **agent_performance_gain**: F√∂rb√§ttring i agentprestanda √∂ver tid
- **feedback_density**: Frekvens och kvalitet av feedbacksignaler
- **reward_volatility**: Stabilitet i bel√∂ningssignaler
- **overfitting_penalty**: Detektering av √∂veranpassning
- **decision_diversity**: Variation i beslut och agentbeteenden

**Implementerat:**
- ‚úÖ MetaParameterAgent-klass i rl_controller f√∂r PPO-baserad parameterjustering
- ‚úÖ Reward signal-ber√§kning fr√•n agent performance, feedback och system metrics
- ‚úÖ Parameter_adjustment events publiceras till alla ber√∂rda moduler
- ‚úÖ Meta_agent_evolution_engine tar emot och anv√§nder adaptiva parametrar
- ‚úÖ Strategic_memory_engine loggar parameterhistorik med beslut och utfall
- ‚úÖ Agent_manager sp√•rar parameterversioner parallellt med agentversioner
- ‚úÖ Parameterhistorik och metrics tillg√§ngliga via get_parameter_history()
- ‚úÖ 15 nya tester f√∂r adaptiv parameterstyrning (alla passerar)

**Testresultat:**
- ‚úÖ MetaParameterAgent justerar parametrar baserat p√• reward signals
- ‚úÖ Parametrar h√•ller sig inom definierade bounds
- ‚úÖ Parameterhistorik loggas korrekt i alla ber√∂rda moduler
- ‚úÖ Parameter_adjustment events distribueras via message_bus
- ‚úÖ Evolution engine anv√§nder dynamiska parametrar fr√•n RL
- ‚úÖ Strategic memory kopplar parameterkontext till beslut
- ‚úÖ Agent manager inkluderar parameterhistorik i agent profiles
- ‚úÖ 44 tester totalt f√∂r Sprint 4 + 4.2 moduler (alla passerar)

**Benefits:**
- Sj√§lvjusterande system utan h√•rdkodade tr√∂skelv√§rden
- F√∂rb√§ttrad agentutveckling och beslutskvalitet √∂ver tid
- Transparent parameterhistorik och bel√∂ningsfl√∂de
- Fullt kompatibelt med befintlig arkitektur
- Adaptiv respons p√• olika marknadsf√∂rh√•llanden
- Reducerad manuell finjustering och underh√•ll

### Sprint 4: Strategiskt minne och agentutveckling ‚úÖ

**M√•l:** Logga beslut, analysera agentperformance och utveckla logik.

**Moduler i fokus:**
- `strategic_memory_engine` - Beslutshistorik och korrelationsanalys
- `meta_agent_evolution_engine` - Agentperformance-analys och evolutionslogik
- `agent_manager` - Versionshantering och agentprofiler

**Nya indikatorer i Sprint 4:**
- ROE (Return on Equity) - Kapitaleffektivitet
- ROA (Return on Assets) - Tillg√•ngsproduktivitet
- ESG Score - Etisk risk och l√•ngsiktig h√•llbarhet
- Earnings Calendar - Eventbaserad risk och timing

**Implementerat:**
- ‚úÖ Beslutshistorik loggas och analyseras
- ‚úÖ Agentversioner sp√•ras och hanteras
- ‚úÖ Evolutionstr√§d visualiseras
- ‚úÖ Korrelationsanalys mellan indikatorer och utfall
- ‚úÖ Agentperformance-metriker genereras
- ‚úÖ 29 tester f√∂r Sprint 4 moduler (alla passerar)

### Sprint 3: Feedbackloopar och introspektion ‚úÖ

**M√•l:** Inf√∂r feedback mellan moduler och visualisera kommunikation.

**Moduler i fokus:**
- `message_bus` - Central pub/sub-kommunikation (f√∂rb√§ttrad)
- `feedback_router` - Intelligent feedback-routing med prioritering
- `feedback_analyzer` - Avancerad m√∂nsteranalys och detektering
- `introspection_panel` - Dashboard-data f√∂r Dash-visualisering

**Nya indikatorer i Sprint 3:**
- News Sentiment - Marknadssentiment fr√•n nyhetsfl√∂den
- Insider Sentiment - Insiderhandel och confidence-signaler

**Implementerat:**
- ‚úÖ Intelligent feedback-routing med prioritering (critical, high, medium, low)
- ‚úÖ Performance pattern detection (slippage, success rate, capital changes)
- ‚úÖ Indicator mismatch detection f√∂r korrelationsanalys
- ‚úÖ Agent drift detection f√∂r performance degradation
- ‚úÖ Dashboard-data med agent adaptation metrics
- ‚úÖ Modul-kopplingar och kommunikationsfl√∂den
- ‚úÖ Dash-baserad feedback flow visualisering
- ‚úÖ 23 tester f√∂r feedback-systemet (alla passerar)

**Testresultat:**
- ‚úÖ Modulkommunikation fungerar via message_bus
- ‚úÖ Feedbackfl√∂de routas och loggas med prioriteter
- ‚úÖ M√∂nsteranalys identifierar 3+ pattern-typer
- ‚úÖ Dashboard genererar rik visualiseringsdata
- ‚úÖ Agent adaptation tracking visar trends

### Sprint 2: RL och bel√∂ningsfl√∂de ‚úÖ

**M√•l:** Inf√∂r PPO-agenter i strategi, risk och beslut. Bel√∂ning via portf√∂lj.

**Moduler i fokus:**
- `rl_controller` - PPO-agenttr√§ning och distribution
- `strategy_engine` - RL-f√∂rb√§ttrade strategier med MACD
- `risk_manager` - RL-baserad riskbed√∂mning med ATR
- `decision_engine` - RL-optimerade beslut
- `portfolio_manager` - Reward-generering f√∂r RL

**Nya indikatorer i Sprint 2:**
- MACD (Moving Average Convergence Divergence) - Momentum och trendstyrka
- ATR (Average True Range) - Volatilitetsbaserad riskjustering
- Analyst Ratings - Extern confidence och sentiment

**Testresultat:**
- ‚úÖ RL-bel√∂ning ber√§knas fr√•n portfolio changes
- ‚úÖ PPO-agenter tr√§nas i rl_controller
- ‚úÖ Agentuppdateringar distribueras till moduler (strategy, risk, decision, execution)
- ‚úÖ 4 RL-agenter aktiva och tr√§nas parallellt
- ‚úÖ Feedback-fl√∂de implementerat och loggas
- ‚úÖ Strategier anv√§nder flera indikatorer kombinerat (RSI + MACD + Analyst Ratings)
- ‚úÖ Riskbed√∂mning anpassad efter volatilitet (ATR)

### Sprintplan - Sprint 1: K√§rnsystem och demoportf√∂lj ‚úÖ

**M√•l:** Bygg ett fungerande end-to-end-fl√∂de med verkliga data, strategi, beslut, exekvering och portf√∂lj.

**Moduler i fokus:**
- `data_ingestion` - H√§mtar trending symboler och √∂ppnar WebSocket
- `strategy_engine` - Genererar tradef√∂rslag baserat p√• indikatorer
- `decision_engine` - Samlar insikter och fattar beslut
- `execution_engine` - Simulerar eller exekverar trades
- `portfolio_manager` - Hanterar demoportf√∂lj med startkapital (1000 USD) och avgifter (0.25%)
- `indicator_registry` - H√§mtar och distribuerar indikatorer fr√•n Finnhub

**Indikatorer som anv√§nds:**
- OHLC (Open, High, Low, Close)
- Volume (Volym)
- SMA (Simple Moving Average)
- RSI (Relative Strength Index)

**Testbara m√•l:**
- ‚úÖ Simulerad handel fungerar
- ‚úÖ Portf√∂ljstatus uppdateras korrekt
- ‚úÖ Indikatorfl√∂de fr√•n Finnhub fungerar

**Startkapital:** 1000 USD  
**Transaktionsavgift:** 0.25%

---

## üîÑ Sprint 4: Strategiskt minne och agentutveckling

### Memory och Evolution Arkitektur

Sprint 4 introducerar strategiskt minne och evolution√§r agentutveckling f√∂r l√•ngsiktig systemf√∂rb√§ttring.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ decision_engine  ‚îÇ‚îÄ‚îÄ‚îê
‚îÇ execution_engine ‚îÇ  ‚îÇ
‚îÇindicator_registry‚îÇ  ‚îÇ decisions, indicators, results
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
                      ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ strategic_memory     ‚îÇ
            ‚îÇ (Historik & Analys)  ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ memory_insights
                       ‚îÇ
                       ‚îú‚îÄ‚îÄ‚ñ∂ decision_engine
                       ‚îÇ
                       ‚îú‚îÄ‚îÄ‚ñ∂ feedback_analyzer
                       ‚îÇ
                       ‚îî‚îÄ‚îÄ‚ñ∂ introspection_panel
                       
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ rl_controller    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ meta_agent       ‚îÇ
‚îÇ (agent_status)   ‚îÇ     ‚îÇ evolution_engine ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ (Analyserar      ‚îÇ
                         ‚îÇ  performance)     ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ feedback_analyzer‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂         ‚îÇ evolution_suggestion
‚îÇ (insights)       ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚ñº
                         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                         ‚îÇ agent_manager    ‚îÇ
                         ‚îÇ (Versioner &     ‚îÇ
                         ‚îÇ  Profiles)       ‚îÇ
                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚îÇ agent_profile
                                  ‚îÇ
                                  ‚îî‚îÄ‚îÄ‚ñ∂ Alla RL-moduler
```

### Strategic Memory Engine

**StrategicMemoryEngine** loggar och analyserar all historisk data:

**Datalagring:**
- **Decision History**: Alla handelsbeslut med kontext
- **Indicator History**: Indikatorer per symbol √∂ver tid
- **Execution History**: Resultat fr√•n alla trades
- **Feedback Storage**: Alla feedback events
- **Agent Responses**: RL-agent status och updates

**Korrelationsanalys:**
- Identifierar vilka indikatorer som korrelerar med framg√•ng
- Ber√§knar success rate per indikator
- Sp√•rar average profit per indikator
- Genererar "best indicators" och "worst indicators" listor

**Insight Generation:**
- Success rate √∂ver tid
- Average profit trends
- Performance degradation detection
- Recommendations baserat p√• historik

### Meta Agent Evolution Engine

**MetaAgentEvolutionEngine** analyserar och f√∂rb√§ttrar RL-agenter:

**Performance Tracking:**
- Sp√•rar varje agents performance √∂ver tid
- J√§mf√∂r f√∂rsta halvan vs andra halvan av historik
- Detekterar degradation > 15% (konfigurerbar threshold)

**Evolution Triggers:**
1. **Performance Degradation**: F√∂resl√•r justering av learning rate, exploration
2. **Agent Drift Detection**: F√∂resl√•r stabilisering av tr√§ning
3. **System-Wide Issues**: F√∂resl√•r √∂versyn av reward function

### Agent Manager

**AgentManager** hanterar agentprofiler och versioner:

**Default Agents:**
- strategy_agent, risk_agent, decision_agent, execution_agent

**Versionshantering:**
- Automatisk version increment vid evolution
- Patch (1.0.0 ‚Üí 1.0.1) f√∂r agent-specifika √§ndringar
- Minor (1.0.0 ‚Üí 1.1.0) f√∂r system-wide √§ndringar
- Fullst√§ndig versionshistorik

### Sprint 4 Indikatorer

- **ROE (Return on Equity)**: Kapitaleffektivitet
- **ROA (Return on Assets)**: Tillg√•ngsproduktivitet
- **ESG Score**: Etisk risk och h√•llbarhet
- **Earnings Calendar**: Eventbaserad risk och timing

### Testning

**Testresultat:** 24/24 tester passerar
- StrategicMemoryEngine: 11 tester
- MetaAgentEvolutionEngine: 6 tester
- AgentManager: 7 tester

---

## üß† Arkitektur√∂versikt

Sprint 1 implementerar ett komplett end-to-end handelssystem med f√∂ljande fl√∂de:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    Finnhub      ‚îÇ
‚îÇ   (Data k√§lla)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                  ‚îÇ
         ‚ñº                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ data_ingestion   ‚îÇ  ‚îÇindicator_registry‚îÇ
‚îÇ  (Market data)   ‚îÇ  ‚îÇ  (Indikatorer)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                     ‚îÇ
         ‚îÇ                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                            ‚ñº
         ‚îÇ                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                   ‚îÇ strategy_engine  ‚îÇ
         ‚îÇ                   ‚îÇ (Tradef√∂rslag)   ‚îÇ
         ‚îÇ                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                            ‚îÇ
         ‚îÇ                            ‚ñº
         ‚îÇ                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                   ‚îÇ decision_engine  ‚îÇ
         ‚îÇ                   ‚îÇ (Slutgiltigt     ‚îÇ
         ‚îÇ                   ‚îÇ  beslut)         ‚îÇ
         ‚îÇ                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                            ‚îÇ
         ‚îÇ                            ‚ñº
         ‚îÇ                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                   ‚îÇ execution_engine ‚îÇ
         ‚îÇ                   ‚îÇ (Exekvering)     ‚îÇ
         ‚îÇ                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                            ‚îÇ
         ‚îÇ                            ‚ñº
         ‚îÇ                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇportfolio_manager ‚îÇ
                             ‚îÇ (Portf√∂ljstatus) ‚îÇ
                             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚îÇ
                                      ‚ñº
                             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                             ‚îÇ  message_bus     ‚îÇ
                             ‚îÇ  (Pub/Sub)       ‚îÇ
                             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Modulbeskrivningar och Kopplingar

#### 1. **data_ingestion** (Entry Point)
- **Roll:** H√§mtar marknadsdata fr√•n Finnhub via WebSocket
- **Publicerar:** `market_data` till message_bus
- **Anv√§nds av:** Alla moduler som beh√∂ver realtidsdata

#### 2. **indicator_registry** (Entry Point)
- **Roll:** H√§mtar och distribuerar tekniska indikatorer fr√•n Finnhub
- **Publicerar:** `indicator_data` till message_bus
- **Uppdateringsintervall:** 5 minuter
- **Indikatorer:** OHLC, Volume, SMA, RSI (Sprint 1)
- **Prenumeranter:** strategy_engine, decision_engine

#### 3. **strategy_engine**
- **Roll:** Genererar tradef√∂rslag baserat p√• tekniska indikatorer
- **Prenumererar p√•:** `indicator_data`, `portfolio_status`
- **Publicerar:** `decision_proposal` till decision_engine
- **Indikatoranv√§ndning:**
  - OHLC: Entry/exit signals
  - Volume: Liquidity assessment
  - SMA: Trend detection
  - RSI: Overbought/oversold (< 30 = k√∂p, > 70 = s√§lj)

#### 4. **decision_engine**
- **Roll:** Fattar slutgiltiga handelsbeslut
- **Prenumererar p√•:** `decision_proposal`, `risk_profile`, `memory_insights`
- **Publicerar:** `final_decision` till execution_engine
- **Logik:** Kombinerar strategi med risk (Sprint 1: enkel logik, Sprint 2: RL)

#### 5. **execution_engine**
- **Roll:** Simulerar trade-exekvering med slippage
- **Prenumererar p√•:** `final_decision`
- **Publicerar:** `execution_result`, `trade_log`, `feedback_event`
- **Simulering:**
  - Slippage: 0-0.5%
  - Latency tracking
  - Execution quality feedback

#### 6. **portfolio_manager**
- **Roll:** Hanterar portf√∂lj och ber√§knar reward
- **Prenumererar p√•:** `execution_result`
- **Publicerar:** `portfolio_status`, `reward`, `feedback_event`
- **Parametrar:**
  - Startkapital: 1000 USD
  - Transaktionsavgift: 0.25%
  - Tracking: P&L, positioner, trade history

### Feedbackloop-koncept (Sprint 1 grund, fullt i Sprint 3)

Sprint 1 l√§gger grunden f√∂r feedback-systemet som anv√§nds i kommande sprintar:

#### Feedback-k√§llor (enligt feedback_loop.yaml):

**1. execution_engine feedback:**
- **Triggers:**
  - `trade_result`: Lyckad/misslyckad trade
  - `slippage`: Skillnad mellan f√∂rv√§ntat och verkligt pris (>0.2% loggas)
  - `latency`: Exekveringstid
- **Emitterar:** `feedback_event` till message_bus

**2. portfolio_manager feedback:**
- **Triggers:**
  - `capital_change`: √Ñndring i totalt portf√∂ljv√§rde
  - `transaction_cost`: Kostnad f√∂r varje trade
- **Emitterar:** `feedback_event` och `reward` till message_bus

**3. Feedback Routing (Sprint 3):**
```
feedback_event ‚Üí feedback_router ‚Üí 
  ‚îú‚îÄ rl_controller (f√∂r agenttr√§ning)
  ‚îú‚îÄ feedback_analyzer (m√∂nsteridentifiering)
  ‚îî‚îÄ strategic_memory_engine (loggning)
```

**4. RL Response (Sprint 2):**
- `rl_controller` tar emot reward fr√•n portfolio_manager
- Uppdaterar RL-agenter i strategy_engine, decision_engine, execution_engine
- Bel√∂ning baserad p√•:
  - Portfolio value change
  - Trade profitability
  - Execution quality

### Indikatoranv√§ndning (fr√•n indicator_map.yaml)

| Indikator | Typ       | Anv√§nds av        | Syfte                           |
|-----------|-----------|-------------------|---------------------------------|
| OHLC      | Technical | strategy, execution | Price analysis, entry/exit    |
| Volume    | Technical | strategy          | Liquidity assessment            |
| SMA       | Technical | strategy          | Trend detection, smoothing      |
| RSI       | Technical | strategy, decision | Overbought/oversold detection  |

**Kommande indikatorer (Sprint 2-7):**
- Sprint 2: MACD, ATR, Analyst Ratings
- Sprint 3: News Sentiment, Insider Sentiment
- Sprint 4: ROE, ROA, ESG, Earnings Calendar
- Sprint 5: Bollinger Bands, ADX, Stochastic Oscillator

### Message Bus - Central Kommunikation

Alla moduler kommunicerar via `message_bus.py` med pub/sub-m√∂nster:

**Topics i Sprint 1:**
- `market_data`: Fr√•n data_ingestion
- `indicator_data`: Fr√•n indicator_registry
- `decision_proposal`: Fr√•n strategy_engine
- `final_decision`: Fr√•n decision_engine
- `execution_result`: Fr√•n execution_engine
- `portfolio_status`: Fr√•n portfolio_manager
- `reward`: Fr√•n portfolio_manager
- `feedback_event`: Fr√•n execution_engine och portfolio_manager

**F√∂rdelar:**
- L√∂s koppling mellan moduler
- Enkel att l√§gga till nya prenumeranter
- Meddelandelogg f√∂r debugging och introspektion

---

## üß† Arkitektur√∂versikt

Systemet best√•r av frist√•ende moduler som kommunicerar via en central `message_bus`. Varje modul kan:
- Skicka och ta emot feedback
- Tr√§nas med PPO-agenter via `rl_controller`
- Visualiseras via introspektionspaneler
- Anv√§nda indikatorer fr√•n Finnhub via `indicator_registry`

---

## üì¶ Modul√∂versikt

| Modul                      | Syfte                                                                 |
|---------------------------|------------------------------------------------------------------------|
| `data_ingestion.py`       | H√§mtar trending symboler och √∂ppnar WebSocket                         |
| `strategy_engine.py`      | Genererar tradef√∂rslag baserat p√• indikatorer och RL                  |
| `risk_manager.py`         | Bed√∂mer risk och justerar strategi                                    |
| `decision_engine.py`      | Samlar insikter och fattar beslut                                     |
| `execution_engine.py`     | Simulerar eller exekverar trades                                      |
| `portfolio_manager.py`    | Hanterar demoportf√∂lj med startkapital och avgifter                   |
| `indicator_registry.py`   | H√§mtar och distribuerar indikatorer fr√•n Finnhub                      |
| `rl_controller.py`        | Tr√§nar PPO-agenter och samlar bel√∂ning                                |
| `feedback_router.py`      | Skickar feedback mellan moduler                                       |
| `feedback_analyzer.py`    | Identifierar m√∂nster i feedbackfl√∂den                                 |
| `strategic_memory_engine.py` | Loggar beslut, r√∂ster och utfall                                     |
| `meta_agent_evolution_engine.py` | Utv√§rderar och utvecklar agentlogik                          |
| `agent_manager.py`        | Hanterar agentprofiler och versioner                                  |
| `vote_engine.py`          | Genomf√∂r r√∂stning mellan agenter                                     |
| `consensus_engine.py`     | V√§ljer konsensusmodell och l√∂ser konflikter                           |
| `decision_simulator.py`   | Testar alternativa beslut i sandbox                                   |
| `timespan_tracker.py`     | Synkroniserar beslut √∂ver tid                                         |
| `action_chain_engine.py`  | Definierar √•teranv√§ndbara beslutskedjor                               |
| `introspection_panel.py`  | Visualiserar modulstatus och RL-performance                           |
| `system_monitor.py`       | Visar system√∂versikt, indikatortrender och agentrespons               |

---


## üìä Indikatorer fr√•n Finnhub

Systemet anv√§nder tekniska, fundamentala och alternativa indikatorer:

- **Tekniska:** OHLC, RSI, MACD, Bollinger Bands, ATR, VWAP, ADX
- **Fundamentala:** EPS, ROE, ROA, margin, analyst ratings, dividend yield
- **Alternativa:** News sentiment, insider sentiment, ESG, social media

Alla indikatorer h√§mtas via `indicator_registry.py` och distribueras via `message_bus`.

---


## üèÅ Sprintstruktur

Projektet √§r uppdelat i 7 sprintar. Se `sprint_plan.yaml` f√∂r detaljer.

| Sprint | Fokus                                | Status  |
|--------|--------------------------------------|---------|
| 1      | K√§rnsystem och demoportf√∂lj          | ‚úÖ F√§rdig|
| 2      | RL och bel√∂ningsfl√∂de                | ‚úÖ F√§rdig|
| 3      | Feedbackloopar och introspektion     | ‚úÖ F√§rdig|
| 4      | Strategiskt minne och agentutveckling| üîÑ P√•g√•r|
| 5      | Simulering och konsensus             | ‚è≥ Planerad|
| 6      | Tidsanalys och action chains         | ‚è≥ Planerad|
| 7      | Indikatorvisualisering och √∂versikt  | ‚è≥ Planerad|

Se `README_sprints.md` f√∂r detaljerad beskrivning av varje sprint.

---

## üß™ Teststruktur

Alla moduler har motsvarande testfiler i `tests/`. Testerna √§r uppdelade i:
- Modulfunktionalitet
- RL-bel√∂ning och agentrespons
- Feedbackfl√∂de
- Indikatorintegration

---

## üß© Onboardingtips

- Alla moduler kommunicerar via `message_bus.py`
- RL-bel√∂ning hanteras centralt via `rl_controller.py`
- Feedback skickas via `feedback_router.py`
- Indikatorer h√§mtas via `indicator_registry.py`
- Varje modul har introspektionspanel f√∂r transparens

---


NextGenAITrader/
‚îú‚îÄ‚îÄ main.py                      # Startpunkt f√∂r systemet
‚îú‚îÄ‚îÄ requirements.txt             # Pythonberoenden

‚îú‚îÄ‚îÄ modules/                     # Alla k√§rnmoduler
‚îÇ   ‚îú‚îÄ‚îÄ data_ingestion.py
‚îÇ   ‚îú‚îÄ‚îÄ strategy_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ risk_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ decision_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ vote_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ consensus_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ execution_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ portfolio_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ indicator_registry.py
‚îÇ   ‚îú‚îÄ‚îÄ rl_controller.py
‚îÇ   ‚îú‚îÄ‚îÄ feedback_router.py
‚îÇ   ‚îú‚îÄ‚îÄ feedback_analyzer.py
‚îÇ   ‚îú‚îÄ‚îÄ strategic_memory_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ meta_agent_evolution_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ agent_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ decision_simulator.py
‚îÇ   ‚îú‚îÄ‚îÄ timespan_tracker.py
‚îÇ   ‚îú‚îÄ‚îÄ action_chain_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ introspection_panel.py
‚îÇ   ‚îî‚îÄ‚îÄ system_monitor.py

‚îú‚îÄ‚îÄ tests/                       # Testfiler per modul
‚îÇ   ‚îú‚îÄ‚îÄ test_data_ingestion.py
‚îÇ   ‚îú‚îÄ‚îÄ test_strategy_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ test_risk_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ test_decision_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ test_vote_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ test_consensus_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ test_execution_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ test_portfolio_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ test_indicator_registry.py
‚îÇ   ‚îú‚îÄ‚îÄ test_rl_controller.py
‚îÇ   ‚îú‚îÄ‚îÄ test_feedback_router.py
‚îÇ   ‚îú‚îÄ‚îÄ test_feedback_analyzer.py
‚îÇ   ‚îú‚îÄ‚îÄ test_strategic_memory_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ test_meta_agent_evolution_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ test_agent_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ test_decision_simulator.py
‚îÇ   ‚îú‚îÄ‚îÄ test_timespan_tracker.py
‚îÇ   ‚îú‚îÄ‚îÄ test_action_chain_engine.py
‚îÇ   ‚îú‚îÄ‚îÄ test_introspection_panel.py
‚îÇ   ‚îî‚îÄ‚îÄ test_system_monitor.py

‚îú‚îÄ‚îÄ dashboards/                  # Dash-paneler f√∂r visualisering
‚îÇ   ‚îú‚îÄ‚îÄ portfolio_overview.py
‚îÇ   ‚îú‚îÄ‚îÄ rl_metrics.py
‚îÇ   ‚îú‚îÄ‚îÄ feedback_flow.py
‚îÇ   ‚îú‚îÄ‚îÄ indicator_trends.py
‚îÇ   ‚îú‚îÄ‚îÄ consensus_visualizer.py
‚îÇ   ‚îú‚îÄ‚îÄ agent_evolution.py
‚îÇ   ‚îî‚îÄ‚îÄ system_status.py

‚îú‚îÄ‚îÄ docs/                        # Dokumentation och onboarding
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îú‚îÄ‚îÄ README_sprints.md
‚îÇ   ‚îú‚îÄ‚îÄ onboarding_guide.md
‚îÇ   ‚îú‚îÄ‚îÄ sprint_plan.yaml
‚îÇ   ‚îú‚îÄ‚îÄ structure.yaml
‚îÇ   ‚îú‚îÄ‚îÄ functions.yaml
‚îÇ   ‚îú‚îÄ‚îÄ indicator_map.yaml
‚îÇ   ‚îú‚îÄ‚îÄ agent_profiles.yaml
‚îÇ   ‚îú‚îÄ‚îÄ consensus_models.yaml
‚îÇ   ‚îú‚îÄ‚îÄ action_chains.yaml
‚îÇ   ‚îú‚îÄ‚îÄ test_map.yaml
‚îÇ   ‚îî‚îÄ‚îÄ introspection_config.yaml

‚îú‚îÄ‚îÄ config/                      # Inst√§llningar och nycklar
‚îÇ   ‚îú‚îÄ‚îÄ finnhub_keys.yaml
‚îÇ   ‚îú‚îÄ‚îÄ agent_roles.yaml
‚îÇ   ‚îú‚îÄ‚îÄ chain_templates.yaml
‚îÇ   ‚îî‚îÄ‚îÄ rl_parameters.yaml

‚îú‚îÄ‚îÄ logs/                        # Loggar och historik
‚îÇ   ‚îú‚îÄ‚îÄ feedback_log.json
‚îÇ   ‚îú‚îÄ‚îÄ decision_history.json
‚îÇ   ‚îú‚îÄ‚îÄ agent_performance.json
‚îÇ   ‚îî‚îÄ‚îÄ trade_log.json

‚îú‚îÄ‚îÄ data/                        # Lokala datak√§llor och cache
‚îÇ   ‚îú‚îÄ‚îÄ cached_indicators/
‚îÇ   ‚îú‚îÄ‚îÄ simulation_results/
‚îÇ   ‚îî‚îÄ‚îÄ snapshots/
